<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Confirmação de Cadastro – Clínica Personart</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#111827;
      --muted:#e5e7eb;
      --text:#f8fafc;
      --brand:#F2C8A0;
      --brand-dark:#E3B189;
      --border:#374151;
      --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans";
      background:linear-gradient(180deg,#020617 0%,#020617 40%,#0f172a 100%);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }
    .card{
      background:radial-gradient(900px 200px at 10% -10%,rgba(242,200,160,.16),transparent),
                 linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));
      border:1px solid var(--border);
      border-radius:18px;
      padding:18px 18px 20px;
      max-width:520px;
      width:100%;
      box-shadow:0 16px 50px rgba(0,0,0,.55);
    }
    h1{
      margin:0 0 4px;
      font-size:22px;
      color:var(--brand);
    }
    .subtitle{
      margin:0 0 14px;
      font-size:13px;
      color:#cbd5e1;
    }
    label{
      display:block;
      font-size:13px;
      color:#e5e7eb;
      margin-bottom:4px;
    }
    input[type="text"],
    input[type="tel"],
    input[type="email"]{
      width:100%;
      background:#020617;
      color:var(--text);
      border:1px solid var(--border);
      border-radius:10px;
      padding:9px 10px;
      font-size:14px;
      outline:none;
    }
    .lgpd-box{
      margin-top:10px;
      padding:8px;
      border-radius:10px;
      border:1px solid var(--border);
      background:#020617;
      font-size:12px;
      color:#d1d5db;
    }
    .lgpd-box strong{color:var(--brand);}
    .lgpd-check{
      display:flex;
      align-items:flex-start;
      gap:6px;
      margin-top:6px;
      font-size:12px;
    }
    .lgpd-check input{margin-top:2px;}
    .btn{
      appearance:none;
      border:0;
      border-radius:999px;
      padding:10px 16px;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
    }
    .btn-primary{
      background:var(--brand);
      color:#111827;
      width:100%;
      margin-top:14px;
    }
    .btn-primary:disabled{
      opacity:.6;
      cursor:wait;
    }
    .btn-review{
      margin-top:10px;
      background:transparent;
      border-radius:999px;
      border:1px solid var(--brand);
      color:var(--brand);
      text-decoration:none;
      padding:9px 14px;
      font-size:14px;
      font-weight:600;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
    }
    .btn-review span.stars{
      font-size:16px;
    }
    .status{
      margin-top:10px;
      font-size:13px;
      text-align:center;
    }
    .status.ok{color:#bbf7d0;}
    .status.err{color:#fecaca;}
    .small{
      font-size:11px;
      color:#9ca3af;
      margin-top:10px;
      text-align:center;
    }
    .center{
      text-align:center;
      margin-top:6px;
    }
    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
  </style>
</head>
<body>
  <main class="card">
    <header>
      <h1>Confirmação de cadastro</h1>
      <p class="subtitle">
        Se você já é paciente da Clínica Personart, confirme seus dados abaixo.
      </p>
    </header>

    <form id="form-confirmacao">
      <div>
        <label for="nome">Nome completo *</label>
        <input id="nome" type="text" required placeholder="Ex.: Ana Silva" />
      </div>

      <div style="margin-top:10px">
        <label for="contato">Telefone / WhatsApp *</label>
        <input id="contato" type="tel" required placeholder="(15) 9 9999-9999" />
      </div>

      <div style="margin-top:10px">
        <label for="email">E-mail (opcional)</label>
        <input id="email" type="email" placeholder="voce@exemplo.com" />
      </div>

      <div class="row" style="margin-top:10px">
        <div style="flex:1;">
          <label for="carteirinha">Número da carteirinha (se houver)</label>
          <input id="carteirinha" type="text" placeholder="Ex.: 123456789" />
        </div>
        <div style="flex:1;">
          <label for="crm">CRM do médico que encaminhou (se souber)</label>
          <input id="crm" type="text" placeholder="Ex.: CRM-SP 123456" />
        </div>
      </div>

      <div class="lgpd-box">
        <strong>LGPD – Confirmação</strong>
        <p style="margin:4px 0 0;">
          Ao confirmar, você autoriza a Clínica Personart a manter e atualizar seus dados
          para fins de contato, agendamento e organização interna do atendimento,
          conforme a Lei Geral de Proteção de Dados (LGPD).
        </p>
        <label class="lgpd-check">
          <input type="checkbox" id="lgpd" required />
          <span>Confirmo que sou paciente da Clínica Personart e concordo com o uso dos meus dados conforme acima.</span>
        </label>
      </div>

      <button class="btn btn-primary" type="submit" id="btn-enviar">Confirmar cadastro</button>
    </form>

    <div id="status" class="status"></div>

    <div id="review-area" class="center" style="display:none;">
      <p style="font-size:13px; color:#e5e7eb; margin:8px 0 6px;">
        Seu retorno ajuda muito outros pacientes a encontrarem atendimento psicológico de qualidade.
        Se puder, avalie a Clínica Personart no Google com
        <strong>5 estrelas</strong>.
      </p>
      <a id="btn-review" class="btn-review" href="#" target="_blank" rel="noopener noreferrer">
        <span class="stars">★★★★★</span>
        <span>Avaliar no Google</span>
      </a>
    </div>

    <div class="small">Desenvolvido para Clínica Personart.</div>
  </main>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxzJMIZBnlQaj1YSrP7Al585qoFrjm7jthbYvVo8eZkyGOrS6iPr6WVie4mqnCsJ-K_7A/exec";
    const GOOGLE_REVIEW_URL = "https://g.page/r/CeVIkm6xjD-zEBM/review";

    const $ = (s,r=document)=>r.querySelector(s);

    const form = $('#form-confirmacao');
    const statusEl = $('#status');
    const btn = $('#btn-enviar');
    const reviewArea = $('#review-area');
    const btnReview = $('#btn-review');

    btnReview.href = GOOGLE_REVIEW_URL;

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      statusEl.textContent = '';
      statusEl.className = 'status';

      const nome = $('#nome').value.trim();
      const contato = $('#contato').value.trim();
      const email = $('#email').value.trim();
      const carteirinha = $('#carteirinha').value.trim();
      const crm = $('#crm').value.trim();
      const lgpdOk = $('#lgpd').checked;

      if(!nome || !contato || !lgpdOk){
        statusEl.textContent = 'Preencha nome, contato e marque a confirmação de LGPD.';
        statusEl.classList.add('err');
        return;
      }

      const payload = {
        origem: 'confirmacao_paciente_existente',
        nome,
        contato,
        email,
        carteirinha,
        crm,
        ts: new Date().toISOString()
      };

      btn.disabled = true;
      btn.textContent = 'Enviando...';

      try{
        const res = await fetch(SCRIPT_URL, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({
            kind: 'confirmacao_paciente_existente',
            data: payload
          })
        });

        if(!res.ok) throw new Error('Erro HTTP: '+res.status);

        statusEl.textContent = 'Cadastro confirmado com sucesso. Obrigado por seguir com a Clínica Personart.';
        statusEl.classList.add('ok');

        // Mostra área de review no Google após sucesso
        reviewArea.style.display = 'block';

      }catch(err){
        statusEl.textContent = 'Não foi possível confirmar agora. Tente novamente mais tarde.';
        statusEl.classList.add('err');
        btn.disabled = false;
        btn.textContent = 'Confirmar cadastro';
        return;
      }
    });
  </script>
</body>
</html>
