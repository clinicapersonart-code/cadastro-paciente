
         <div class="grid cols-2" style="margin-top:10px">
           <div>
             <label for="convenio">Convênio</label>
             <div class="row">
               <select id="convenio" style="flex:1"></select>
               <button class="btn btn-outline" type="button" id="btn-add-convenio">+ convênio</button>
             </div>
             <div class="hint">Lista editável. Adicione novos convênios quando precisar.</div>
           </div>
 
           <div>
             <label for="profissional-select">Profissionais que estão atendendo</label>
             <div class="row">
               <select id="profissional-select" style="flex:1"></select>
               <button class="btn btn-outline" type="button" id="btn-add-prof-selection">Adicionar</button>
             </div>
             <div class="row" style="margin-top:8px">
               <input type="text" id="novo-profissional" placeholder="Novo profissional" />
               <button class="btn btn-outline" type="button" id="btn-add-profissional">+ profissional</button>
             </div>
             <div id="pro-preview" class="chips" style="margin-top:6px"></div>
           </div>
         </div>
 
+        <div class="grid cols-2" style="margin-top:10px">
+          <div>
+            <label for="carteirinha">Número da carteirinha</label>
+            <input id="carteirinha" type="text" placeholder="Ex.: 123456789" />
+          </div>
+
+          <div>
+            <label>Tipo de atendimento</label>
+            <div class="row">
+              <label class="radio"><input type="radio" name="tipo-atendimento" value="Convencional" id="tipo-convencional" /> Convencional</label>
+              <label class="radio"><input type="radio" name="tipo-atendimento" value="ABA" id="tipo-aba" /> ABA</label>
+            </div>
+          </div>
+        </div>
+
         <div class="grid cols-2" style="margin-top:10px">
           <div>
             <label for="especialidade-select">Especialidades</label>
             <div class="row">
               <select id="especialidade-select" style="flex:1"></select>
               <button class="btn btn-outline" type="button" id="btn-add-esp-selection">Adicionar</button>
             </div>
             <div class="row" style="margin-top:8px">
               <input type="text" id="nova-especialidade" placeholder="Nova especialidade" />
               <button class="btn btn-outline" type="button" id="btn-add-especialidade">+ especialidade</button>
             </div>
             <div id="esp-preview" class="chips" style="margin-top:6px"></div>
           </div>
 
           <div>
             <label for="crm">CRM do médico que encaminhou</label>
             <input id="crm" type="text" placeholder="Ex.: CRM-SP 123456" />
           </div>
         </div>
 
         <div style="margin-top:10px">
           <label for="origem">Como conheceu a clínica?</label>
           <input id="origem" type="text" list="lista-origens" placeholder="Ex.: Indicação" />
           <datalist id="lista-origens">
             <option value="Indicação"></option>
             <option value="Instagram"></option>
             <option value="Site"></option>
             <option value="Google"></option>
           </datalist>
         </div>
 
         <div class="row" style="margin-top:14px">
           <button class="btn btn-primary" type="submit">Salvar paciente</button>
           <button class="btn btn-outline" type="button" id="btn-limpar">Limpar formulário</button>
         </div>
       </form>
     </section>
 
     <section class="card">
       <div class="section-title">Pacientes</div>
       <div class="toolbar">
-        <input id="busca" type="text" placeholder="Buscar por nome, responsável, contato, CRM ou origem" style="min-width:240px" />
+        <input id="busca" type="text" placeholder="Buscar por nome, responsável, contato, CRM, origem ou carteirinha" style="min-width:240px" />
         <select id="filtro-convenio"><option value="">Todos os convênios</option></select>
         <select id="filtro-profissional"><option value="">Todos os profissionais</option></select>
         <select id="filtro-faixa">
           <option value="">Todas as faixas</option>
           <option value="Criança">Criança</option>
           <option value="Adulto">Adulto</option>
         </select>
         <button class="btn btn-outline" id="btn-ver-todos">Ver todos</button>
         <div class="spacer"></div>
         <button class="btn btn-outline" id="btn-exportar">Exportar CSV</button>
         <button class="btn btn-outline" id="btn-backup-enc">Backup criptografado (.enc.json)</button>
         <label class="btn btn-outline" for="importar" style="cursor:pointer">Importar backup</label>
         <input id="importar" type="file" accept="application/json" style="display:none" />
         <button class="btn btn-outline" id="btn-endpoint">Configurar nuvem</button>
         <button class="btn btn-outline" id="btn-sync">Sincronizar com a nuvem</button>
         <button class="btn btn-danger btn-sm" id="btn-zerar" title="Apagar todos os pacientes">Limpar dados</button>
       </div>
 
       <div id="sync-status" class="muted"></div>
 
       <div id="lista-aviso" class="muted">A lista está oculta. Clique em “Ver todos” ou use a busca/filtros.</div>
 
       <div id="table-wrap" class="hidden" style="overflow:auto;max-height:55vh;border:1px solid var(--border);border-radius:12px;">
         <table id="tabela">
           <thead>
             <tr>
               <th style="min-width:180px">Paciente</th>
               <th>Nasc.</th>
               <th>Faixa</th>
               <th>Responsável</th>
               <th>Endereço</th>
               <th>Contato</th>
               <th>Convênio</th>
+              <th>Carteirinha</th>
+              <th>Tipo</th>
               <th style="min-width:180px">Profissionais</th>
               <th style="min-width:160px">Especialidades</th>
               <th>CRM</th>
               <th>Origem</th>
               <th>Ações</th>
             </tr>
           </thead>
           <tbody></tbody>
         </table>
       </div>
       <div class="muted" id="contador" style="margin-top:8px"></div>
     </section>
   </main>
 
   <footer class="footer">
     Desenvolvido para <strong>Clínica Personart</strong> · LGPD: backups contêm dados sensíveis e são criptografados antes do envio.
   </footer>
 
   <dialog id="brand-dialog">
     <form method="dialog">
       <h3 style="margin:0 0 10px;">Identidade visual</h3>
       <div class="row">
         <div style="flex:1;">
           <label for="brand-color">Cor principal</label>
           <input id="brand-color" type="color" value="#F2C8A0" />
@@ -372,86 +389,94 @@
       });
     }
 
     $('#pro-preview').addEventListener('click',e=>{
       const btn=e.target.closest('.chip-x'); if(!btn) return;
       const name=btn.dataset.name;
       selectedProfessionals=selectedProfessionals.filter(v=>v!==name);
       updateProPreview();
     });
     $('#esp-preview').addEventListener('click',e=>{
       const btn=e.target.closest('.chip-x'); if(!btn) return;
       const name=btn.dataset.name;
       selectedEspecialidades=selectedEspecialidades.filter(v=>v!==name);
       updateEspPreview();
     });
 
     function clearForm(){
       $('#patient-id').value='';
       $('#nome').value='';
       $('#nascimento').value='';
       $('#idade-hint').textContent='';
       $('#faixa-crianca').checked=false; $('#faixa-adulto').checked=false;
       $('#responsavel').value=''; $('#responsavel-wrap').style.display='none';
       $('#endereco').value=''; $('#contato').value='';
       $('#convenio').selectedIndex=0;
+      $('#carteirinha').value='';
+      $('#tipo-convencional').checked=false; $('#tipo-aba').checked=false;
       $('#crm').value=''; $('#origem').value='';
       selectedProfessionals=[]; selectedEspecialidades=[];
       updateProPreview(); updateEspPreview();
     }
 
     function fillForm(p){
       $('#patient-id').value=p.id;
       $('#nome').value=p.nome||'';
       $('#nascimento').value=p.nascimento||'';
       const d=parseISODate(p.nascimento);
       if(d){const t=new Date(); let a=t.getFullYear()-d.getFullYear(); const m=t.getMonth()-d.getMonth(); if(m<0||(m===0&&t.getDate()<d.getDate())) a--; $('#idade-hint').textContent=a>=0?`${a} anos`:'';} else $('#idade-hint').textContent='';
       if(p.faixa==='Criança'){ $('#faixa-crianca').checked=true; $('#responsavel-wrap').style.display=''; } else if(p.faixa==='Adulto'){ $('#faixa-adulto').checked=true; $('#responsavel-wrap').style.display='none'; } else { $('#faixa-crianca').checked=false; $('#faixa-adulto').checked=false; $('#responsavel-wrap').style.display='none'; }
       $('#responsavel').value=p.responsavel||'';
       $('#endereco').value=p.endereco||'';
       $('#contato').value=p.contato||'';
       $('#convenio').value=p.convenio||'';
+      $('#carteirinha').value=p.carteirinha||'';
+      $('#tipo-convencional').checked=p.tipoAtendimento==='Convencional';
+      $('#tipo-aba').checked=p.tipoAtendimento==='ABA';
       $('#crm').value=p.crm||'';
       $('#origem').value=p.origem||'';
       selectedProfessionals=Array.isArray(p.profissionais)?p.profissionais.slice():[];
       selectedEspecialidades=Array.isArray(p.especialidades)?p.especialidades.slice():[];
       updateProPreview(); updateEspPreview();
       window.scrollTo({top:0,behavior:'smooth'});
     }
 
     function getFormData(){
       const nome=$('#nome').value.trim();
       const nascimento=$('#nascimento').value||'';
       const faixa=$('#faixa-crianca').checked?'Criança':($('#faixa-adulto').checked?'Adulto':'');
       const responsavel=$('#responsavel').value.trim();
       const endereco=$('#endereco').value.trim();
       const contato=$('#contato').value.trim();
       const convenio=$('#convenio').value||'';
+      const carteirinha=$('#carteirinha').value.trim();
+      const tipoAtendimento=$('#tipo-convencional').checked?'Convencional':($('#tipo-aba').checked?'ABA':'');
       const crm=$('#crm').value.trim();
       const origem=$('#origem').value.trim();
       return {
         nome, nascimento, faixa, responsavel, endereco, contato, convenio,
+        carteirinha, tipoAtendimento,
         profissionais:selectedProfessionals.slice(),
         especialidades:selectedEspecialidades.slice(),
         crm, origem
       };
     }
 
     function validateForm(d){
       if(!d.nome) return 'Informe o nome do paciente.';
       if(!d.faixa) return 'Selecione se é Criança ou Adulto.';
       if(d.faixa==='Criança' && !d.responsavel) return 'Informe o nome do responsável para pacientes criança.';
       return null;
     }
 
     $('#nascimento').addEventListener('change',()=>{
       const iso=$('#nascimento').value; const d=parseISODate(iso);
       if(!d){$('#idade-hint').textContent='';return;}
       const t=new Date(); let a=t.getFullYear()-d.getFullYear(); const m=t.getMonth()-d.getMonth(); if(m<0||(m===0&&t.getDate()<d.getDate())) a--;
       $('#idade-hint').textContent = a>=0?`${a} anos`:'';
       if(a!=null){ if(a<18){$('#faixa-crianca').checked=true; $('#responsavel-wrap').style.display='';} else {$('#faixa-adulto').checked=true; $('#responsavel-wrap').style.display='none';} }
     });
     $('#faixa-crianca').addEventListener('change',()=>{$('#responsavel-wrap').style.display=$('#faixa-crianca').checked?'':'none';});
     $('#faixa-adulto').addEventListener('change',()=>{$('#responsavel-wrap').style.display='none';});
 
     $('#btn-add-prof-selection').addEventListener('click',()=>{
       const v=$('#profissional-select').value; if(v && !selectedProfessionals.includes(v)){selectedProfessionals.push(v); updateProPreview();}
@@ -609,101 +634,103 @@ document.getElementById('patient-form').addEventListener('submit', async (e)=>{
   } finally {
     if(btn){ btn.disabled = false; btn.textContent = 'Salvar paciente'; }
   }
 });
 
     $('#btn-limpar').addEventListener('click',clearForm);
 
     $('#btn-add-convenio').addEventListener('click',()=>{
       let novo=prompt('Novo convênio:'); if(!novo) return; novo=novo.trim(); if(!novo) return;
       const exists=convenios.some(c=>c.toLowerCase()===novo.toLowerCase());
       if(!exists){convenios.push(novo); convenios.sort((a,b)=>a.localeCompare(b,'pt-BR')); saveJSON(STORAGE_KEYS.CONVENIOS,convenios); renderConvenios(); $('#convenio').value=novo;}
     });
 
     function renderTable(){
       const tbody=$('#tabela tbody'); if(!tbody) return; tbody.innerHTML='';
       const q=$('#busca').value.toLowerCase().trim();
       const fConv=$('#filtro-convenio').value;
       const fPro=$('#filtro-profissional').value;
       const fFaixa=$('#filtro-faixa').value;
       const show=listVisible || q || fConv || fPro || fFaixa;
       $('#table-wrap').classList.toggle('hidden',!show);
       $('#lista-aviso').classList.toggle('hidden',!!show);
       if(!show){$('#contador').textContent=''; return;}
 
       const filtered=pacientes.filter(p=>{
-        const blob=[p.nome,p.responsavel,p.contato,p.crm,p.origem].filter(Boolean).join(' ').toLowerCase();
+        const blob=[p.nome,p.responsavel,p.contato,p.crm,p.origem,p.carteirinha,p.tipoAtendimento].filter(Boolean).join(' ').toLowerCase();
         if(q && !blob.includes(q)) return false;
         if(fConv && p.convenio!==fConv) return false;
         if(fFaixa && p.faixa!==fFaixa) return false;
         if(fPro && !(Array.isArray(p.profissionais) && p.profissionais.includes(fPro))) return false;
         return true;
       }).sort((a,b)=>(a.nome||'').localeCompare(b.nome||'','pt-BR'));
 
       for(const p of filtered){
         const tr=document.createElement('tr');
         const tdNome=document.createElement('td'); const strong=document.createElement('strong'); strong.textContent=p.nome||''; tdNome.appendChild(strong);
         const tdNasc=document.createElement('td'); tdNasc.textContent=formatShort(p.nascimento);
         const tdFaixa=document.createElement('td'); tdFaixa.textContent=p.faixa||'';
         const tdResp=document.createElement('td'); tdResp.textContent=p.faixa==='Criança'?(p.responsavel||''):'';
         const tdEnd=document.createElement('td'); tdEnd.textContent=p.endereco||'';
         const tdContato=document.createElement('td'); tdContato.textContent=p.contato||'';
         const tdConv=document.createElement('td'); tdConv.textContent=p.convenio||'';
+        const tdCart=document.createElement('td'); tdCart.textContent=p.carteirinha||'';
+        const tdTipo=document.createElement('td'); tdTipo.textContent=p.tipoAtendimento||'';
         const tdPro=document.createElement('td'); (p.profissionais||[]).forEach(x=>{const s=document.createElement('span'); s.className='chip'; s.textContent=x; tdPro.appendChild(s); tdPro.appendChild(document.createTextNode(' '));});
         const tdEsp=document.createElement('td'); (p.especialidades||[]).forEach(x=>{const s=document.createElement('span'); s.className='chip'; s.textContent=x; tdEsp.appendChild(s); tdEsp.appendChild(document.createTextNode(' '));});
         const tdCRM=document.createElement('td'); tdCRM.textContent=p.crm||'';
         const tdOrig=document.createElement('td'); tdOrig.textContent=p.origem||'';
         const tdAcoes=document.createElement('td'); tdAcoes.className='actions';
         const btnE=document.createElement('button'); btnE.className='btn btn-outline'; btnE.dataset.acao='editar'; btnE.dataset.id=p.id; btnE.textContent='Editar';
         const btnX=document.createElement('button'); btnX.className='btn btn-danger'; btnX.dataset.acao='excluir'; btnX.dataset.id=p.id; btnX.textContent='Excluir';
         tdAcoes.appendChild(btnE); tdAcoes.appendChild(btnX);
-        tr.appendChild(tdNome); tr.appendChild(tdNasc); tr.appendChild(tdFaixa); tr.appendChild(tdResp); tr.appendChild(tdEnd); tr.appendChild(tdContato); tr.appendChild(tdConv); tr.appendChild(tdPro); tr.appendChild(tdEsp); tr.appendChild(tdCRM); tr.appendChild(tdOrig); tr.appendChild(tdAcoes);
+        tr.appendChild(tdNome); tr.appendChild(tdNasc); tr.appendChild(tdFaixa); tr.appendChild(tdResp); tr.appendChild(tdEnd); tr.appendChild(tdContato); tr.appendChild(tdConv); tr.appendChild(tdCart); tr.appendChild(tdTipo); tr.appendChild(tdPro); tr.appendChild(tdEsp); tr.appendChild(tdCRM); tr.appendChild(tdOrig); tr.appendChild(tdAcoes);
         tbody.appendChild(tr);
       }
       $('#contador').textContent=`${filtered.length} paciente${filtered.length===1?'':'s'}`;
     }
 
     $('#tabela').addEventListener('click',e=>{
       const btn=e.target.closest('button[data-acao]'); if(!btn) return;
       const id=btn.getAttribute('data-id'); const idx=pacientes.findIndex(p=>p.id===id); if(idx< 0) return;
       if(btn.dataset.acao==='editar'){fillForm(pacientes[idx]);}
       else if(btn.dataset.acao==='excluir'){if(confirm('Excluir este paciente?')){pacientes.splice(idx,1); saveJSON(STORAGE_KEYS.PACIENTES,pacientes); renderTable();}}
     });
 
     ['busca','filtro-convenio','filtro-profissional','filtro-faixa'].forEach(id=>{
       document.getElementById(id).addEventListener('input',renderTable);
       document.getElementById(id).addEventListener('change',renderTable);
     });
 
     document.getElementById('btn-ver-todos').addEventListener('click',()=>{listVisible=true; renderTable();});
 
     function toCSV(rows){
       const esc=v=>'"'+String(v??'').replace(/"/g,'""')+'"';
-      const header=['id','nome','nascimento(dd/mm/aa)','faixa','responsavel','endereco','contato','convenio','profissionais','especialidades','crm','origem'];
+      const header=['id','nome','nascimento(dd/mm/aa)','faixa','responsavel','endereco','contato','convenio','carteirinha','tipoAtendimento','profissionais','especialidades','crm','origem'];
       const lines=[header.join(',')];
       for(const r of rows){
-        const arr=[r.id,r.nome,formatShort(r.nascimento),r.faixa,r.responsavel,r.endereco,r.contato,r.convenio,(r.profissionais||[]).join(' | '),(r.especialidades||[]).join(' | '),r.crm,r.origem];
+        const arr=[r.id,r.nome,formatShort(r.nascimento),r.faixa,r.responsavel,r.endereco,r.contato,r.convenio,r.carteirinha,r.tipoAtendimento,(r.profissionais||[]).join(' | '),(r.especialidades||[]).join(' | '),r.crm,r.origem];
         lines.push(arr.map(esc).join(','));
       }
       return lines.join('\n');
     }
 
     function download(filename,content,type='text/plain'){
       const blob=new Blob([content],{type});
       const url=URL.createObjectURL(blob);
       const a=document.createElement('a'); a.href=url; a.download=filename; document.body.appendChild(a); a.click(); document.body.removeChild(a);
       URL.revokeObjectURL(url);
     }
 
     document.getElementById('btn-exportar').addEventListener('click',()=>{download('pacientes_personart.csv',toCSV(pacientes),'text/csv;charset=utf-8');});
     document.getElementById('btn-backup-enc').addEventListener('click', async ()=>{
       let pass = getStr(STORAGE_KEYS.CLOUD_PASS);
       if(!pass){ pass = prompt('Defina a senha do backup criptografado (será salva neste navegador)'); if(!pass) return; saveStr(STORAGE_KEYS.CLOUD_PASS, pass); }
       try {
         const payload = {pacientes,convenios,profissionais,especialidades,ts:new Date().toISOString()};
         const pkg = await encryptJSON(payload, pass);
         download('backup_personart.enc.json', JSON.stringify(pkg), 'application/json');
       } catch (err) {
         alert('Falha ao criptografar: ' + err.message);
       }
     });
 
 
EOF
)
